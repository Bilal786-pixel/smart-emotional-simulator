<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Smart Emotional State Simulator</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0f172a;
  --card:rgba(255,255,255,0.05);
  --text:#f1f5f9;
  --accent:#3b82f6;
}
body.light{
  --bg:#f4f6f9;
  --card:#ffffff;
  --text:#111;
}
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}
.container{max-width:1200px;margin:auto;padding:20px;}
.card{
  background:var(--card);
  backdrop-filter:blur(20px);
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}
.grid{display:grid;grid-template-columns:2fr 1fr;gap:20px;}
.indicator{
  width:20px;height:20px;border-radius:50%;
  display:inline-block;animation:pulse 1.5s infinite;
}
@keyframes pulse{
  0%{transform:scale(1);}
  50%{transform:scale(1.4);}
  100%{transform:scale(1);}
}
button{
  padding:8px 14px;margin:5px;border:none;border-radius:8px;
  cursor:pointer;background:var(--accent);color:white;
}
textarea{
  width:100%;height:80px;background:transparent;
  color:var(--text);border:1px solid #555;border-radius:8px;
}
#heatmap{width:100%;height:250px;border-radius:10px;}
.log{max-height:150px;overflow:auto;font-size:13px;}
.meter{height:10px;border-radius:5px;background:#444;margin-top:5px;}
.meter-fill{height:100%;background:lime;border-radius:5px;}
</style>
</head>
<body>

<div class="container">
<h1>ðŸ§  Smart Emotional State Simulator</h1>

<div class="card">
<h2>Score: <span id="score">50</span></h2>
<h3>State: <span id="state">Neutral</span>
<span class="indicator" id="indicator"></span></h3>
<h4>AI Forecast: <span id="prediction">Analyzing...</span></h4>
<h4>Behavior Type: <span id="cluster">Analyzing...</span></h4>
<h4>Volatility Index: <span id="volatility">0</span></h4>
<div class="meter"><div id="momentum" class="meter-fill" style="width:50%"></div></div>
</div>

<div class="grid">
<div class="card">
<textarea placeholder="Type here to simulate typing..."></textarea>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h3>Emotion Heatmap</h3>
<canvas id="heatmap"></canvas>

<h3>Event Log (Last 10)</h3>
<div id="log" class="log"></div>

<button onclick="Engine.reset()">Reset</button>
<button onclick="Engine.export()">Export</button>
<button onclick="Engine.import()">Import</button>
<button onclick="toggleTheme()">Theme</button>
<button onclick="toggleSound()">Sound</button>
</div>
</div>
</div>

<script>
/* ================= ENGINE ================= */
const Engine={
  score:50,min:0,max:100,
  history:[],events:[],
  update(change,reason){
    const old=this.score;
    this.score=Math.max(this.min,Math.min(this.max,this.score+change));
    if(old===this.score)return;

    const event={
      time:new Date().toLocaleTimeString(),
      change,reason,score:this.score
    };

    this.events.unshift(event);
    if(this.events.length>10)this.events.pop();
    this.history.push(this.score);

    if(soundEnabled)beep(change);
    UI.update();
  },
  reset(){
    this.score=50;
    this.history=[];
    this.events=[];
    UI.update();
  },
  export(){
    const blob=new Blob([JSON.stringify(this)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="session.json";
    a.click();
  },
  import(){
    const input=document.createElement("input");
    input.type="file";
    input.onchange=e=>{
      const file=e.target.files[0];
      const reader=new FileReader();
      reader.onload=()=>{
        const data=JSON.parse(reader.result);
        this.score=data.score||50;
        this.history=data.history||[];
        this.events=data.events||[];
        UI.update();
      };
      reader.readAsText(file);
    };
    input.click();
  }
};

/* ================= AI ENGINE ================= */
const AI={
  predict(){
    if(Engine.history.length<8)return"Analyzing...";
    let recent=Engine.history.slice(-8);
    let velocity=recent[7]-recent[0];
    let volatility=Math.max(...recent)-Math.min(...recent);
    document.getElementById("volatility").innerText=volatility;

    if(velocity>10)return"Entering Deep Focus";
    if(velocity<-10)return"Stress Escalating";
    if(volatility>30)return"Emotional Instability";
    return"Stable";
  },
  cluster(){
    if(Engine.history.length<15)return"Analyzing...";
    let avg=Engine.history.reduce((a,b)=>a+b)/Engine.history.length;
    let variance=Math.max(...Engine.history)-Math.min(...Engine.history);
    if(avg>70&&variance<20)return"Focused";
    if(variance>40)return"Impulsive";
    if(avg<40)return"Reactive";
    return"Calm Observer";
  }
};

/* ================= TRACKER ================= */
const Tracker={
  lastKey:0,keyStart:0,clicks:[],idleTimer:null,heatCtx:null,
  init(){
    document.addEventListener("keydown",this.keyDown.bind(this));
    document.addEventListener("keyup",this.keyUp.bind(this));
    document.addEventListener("mousemove",this.mouseMove.bind(this));
    document.addEventListener("click",this.click.bind(this));
    this.resetIdle();
  },
  keyDown(){
    const now=Date.now();
    if(now-this.lastKey<80)Engine.update(-5,"Typing Pressure");
    this.keyStart=now;this.lastKey=now;this.resetIdle();
  },
  keyUp(){
    const hold=Date.now()-this.keyStart;
    if(hold>800)Engine.update(-5,"Long Key Hold");
    else if(hold<300)Engine.update(5,"Stable Typing");
  },
  mouseMove(e){
    this.drawHeat(e.clientX,e.clientY);
    this.resetIdle();
  },
  click(){
    const now=Date.now();
    this.clicks.push(now);
    this.clicks=this.clicks.filter(t=>now-t<1500);
    if(this.clicks.length>=10){
      Engine.update(-15,"Click Burst");
      this.clicks=[];
    }
    this.resetIdle();
  },
  resetIdle(){
    clearTimeout(this.idleTimer);
    this.idleTimer=setTimeout(()=>Engine.update(-5,"Idle Reset"),60000);
  },
  drawHeat(x,y){
    const ctx=this.heatCtx;
    ctx.fillStyle="rgba(255,0,0,0.05)";
    ctx.beginPath();
    ctx.arc(x%500,y%250,15,0,2*Math.PI);
    ctx.fill();
  }
};

/* ================= UI ================= */
const UI={
  chart:null,
  init(){
    const ctx=document.getElementById("chart");
    this.chart=new Chart(ctx,{
      type:"line",
      data:{labels:[],datasets:[{label:"Mood Score",data:[],borderColor:"#3b82f6"}]},
      options:{animation:false,scales:{y:{min:0,max:100}}}
    });
    Tracker.heatCtx=document.getElementById("heatmap").getContext("2d");
    this.update();
  },
  update(){
    document.getElementById("score").innerText=Engine.score;
    const state=this.getState();
    document.getElementById("state").innerText=state.name;
    document.getElementById("indicator").style.background=state.color;

    document.getElementById("prediction").innerText=AI.predict();
    document.getElementById("cluster").innerText=AI.cluster();
    document.getElementById("momentum").style.width=Engine.score+"%";

    const log=document.getElementById("log");
    log.innerHTML="";
    Engine.events.forEach(e=>{
      log.innerHTML+=`[${e.time}] ${e.reason} (${e.change}) â†’ ${e.score}<br>`;
    });

    this.chart.data.labels.push("");
    this.chart.data.datasets[0].data.push(Engine.score);
    if(this.chart.data.labels.length>60){
      this.chart.data.labels.shift();
      this.chart.data.datasets[0].data.shift();
    }
    this.chart.update();
  },
  getState(){
    if(Engine.score<=20)return{name:"Overstimulated",color:"red"};
    if(Engine.score<=40)return{name:"Frustrated",color:"orange"};
    if(Engine.score<=60)return{name:"Neutral",color:"yellow"};
    if(Engine.score<=80)return{name:"Calm",color:"green"};
    return{name:"Deep Focus",color:"blue"};
  }
};

/* ================= UTILITIES ================= */
let soundEnabled=false;
function toggleTheme(){document.body.classList.toggle("light");}
function toggleSound(){soundEnabled=!soundEnabled;}
function beep(change){
  const ctx=new(window.AudioContext||window.webkitAudioContext)();
  const osc=ctx.createOscillator();
  osc.type="sine";
  osc.frequency.value=change>0?600:200;
  osc.connect(ctx.destination);
  osc.start();osc.stop(ctx.currentTime+0.1);
}

/* INIT */
Tracker.init();
UI.init();
</script>

</body>
</html>
